<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">
<meta name="dcterms.date" content="2025-09-29">

<title>ST-558 Project 1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-991b1886d3c685c7aa2b62b80640c7af.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="fullcontent quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ST-558 Project 1</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">29 September 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="preprocessing" class="level1">
<h1>Preprocessing</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.2     ✔ tibble    3.2.1
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.0.4     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rjson)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quantreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: SparseM</code></pre>
</div>
</div>
</section>
<section id="the-usual-process-to-work-with-a-given-url." class="level1">
<h1>The usual process to work with a given URL.</h1>
<p>This code is simply a proof of concept query of the PUMS Census API. Variables are set for the necessary API inputs which are then used to construct an URL to query <code>cenus.gov</code>. The <code>httr::GET()</code> function contains <code>query</code> and <code>for</code> arguments which receptively take in PUMS API variables and geographic region as inputs to finalize the URL and return an http response object. This object can be further be parsed to extract the raw character data from the query.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PWGTP"</span>,<span class="st">"AGEP"</span>,<span class="st">"SEX"</span>, <span class="st">"FER"</span>, <span class="st">"JWTRNS"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>geography <span class="ot">&lt;-</span> <span class="st">"state:01"</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="st">"2022"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.census.gov/data/"</span>, year, <span class="st">"/acs/acs1/pums?"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> <span class="fu">list</span>(<span class="at">get=</span><span class="fu">paste</span>(variables, <span class="at">collapse=</span><span class="st">","</span>), <span class="st">`</span><span class="at">for</span><span class="st">`</span><span class="ot">=</span>geography))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="helper-function-to-take-what-is-returned-by-get-and-turn-it-into-a-nice-tibble." class="level1">
<h1>Helper function to take what is returned by GET() and turn it into a nice tibble.</h1>
<p>The function <code>get_pums_tibble</code> takes in an http response object returned from <code>httr::GET()</code>, extracts the raw character data using <code>httr::content</code>, and parses it into a formatted tibble, which is finally returned. The process is given below:</p>
<ol type="1">
<li>Parses the HTML content with <code>httr::content</code>.<br>
</li>
<li>Each row of raw html text is returned as a list within a list. Each element must be unlisted into a list of vectors.<br>
</li>
<li>The list is converted into a data frame for easier manipulation. However, each row of raw html text becomes a column instead of a row in the data frame. The column names being text row numbers serve no purpose other than more readable output for debugging.<br>
</li>
<li>The data frame is converted into a matrix for an easier transpose operation. Transposing the matrix takes each observation represented as a column and transforms it into a row. Once the matrix is transformed into a standard format, it’s converted into a tibble.<br>
</li>
<li>The variable names are stored in the first row. The first row is set as the column names and then dropped.<br>
</li>
<li>The formatted tibble is returned.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>get_pums_tibble <span class="ot">&lt;-</span> <span class="cf">function</span>(html_page) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    content <span class="ot">&lt;-</span> <span class="fu">content</span>(html_page, <span class="at">as=</span><span class="st">"parsed"</span>) <span class="co">#</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    content <span class="ot">&lt;-</span> <span class="fu">lapply</span>(content, unlist) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.data.frame</span>(<span class="at">col.names=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(content)) <span class="sc">|&gt;</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> <span class="fu">t</span>() <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    content <span class="ot">&lt;-</span> content <span class="sc">|&gt;</span> <span class="fu">setNames</span>(content[<span class="dv">1</span>,]) <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(content)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-processing" class="level1">
<h1>Data Processing</h1>
<p>This code block pulls a list of state codes from <code>census.gov</code> needed to check whether the user specified state code is correct. On <code>census.gov</code> the variable key appears to only exist for 2021 or later, but the same codes seem to work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Needed for checking valid state codes</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>st_codes <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">paste</span>(<span class="fu">readLines</span>(<span class="st">"https://api.census.gov/data/2022/acs/acs1/pums/variables/ST.json"</span>), <span class="at">collapse=</span><span class="st">""</span>))<span class="sc">$</span>values<span class="sc">$</span>item <span class="sc">|&gt;</span> <span class="fu">names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in
readLines("https://api.census.gov/data/2022/acs/acs1/pums/variables/ST.json"):
incomplete final line found on
'https://api.census.gov/data/2022/acs/acs1/pums/variables/ST.json'</code></pre>
</div>
</div>
</section>
<section id="single-year-function" class="level1">
<h1>Single Year Function</h1>
<p>The function <code>get_single_year()</code> is for parsing a single year of census data from <code>census.gov</code> using the PUMS API according to user specified numerical and categorical variables, the year, and a geographical subset of the data by region, division, or state.</p>
<p>The first 50 lines of code in <code>get_single_year()</code> are for validating user input for <code>year</code>, numeric variables, categorical variables, geography subset, and geography level. If any of these inputs are not the correct data type, undefined options according to the project requirements, or disallowed combinations of variables, then an appropriate error will be thrown. Many values for the correct function arguments are hard coded included geography levels except the state codes. Finally since variables change from year to year, all user supplied variables will be checked if they exist for that given year. If all variables exist the query will proceed, otherwise a warning lets the user know which variables aren’t present during that year and an empty tibble is returned.</p>
<p>Once user input is validated, a URL string must be formatted to query the PUMS API. First, a string represented the geography subset is formatted, which is then concatenated with the other components of the URL. Then, the <code>httr:GET</code> function queries <code>cenus.gov</code> using the <code>query</code> and <code>for</code> arguments to finalized the URL string and return an http response object. Next, <code>get_pums_tibble()</code> processes the http object and returns a tibble with the parsed census data stored within.</p>
<p>The bulk of the code in <code>get_single_year</code> contains logic for finding the midpoint of <code>JWDP</code> and <code>JWAP</code> and converting it into HH:MM:SS format with the <code>hms</code> package. However, these variables are factors corresponding to time ranges represented as strings in a non-standard format. So, first the variable descriptions must be pulled from <code>census.gov</code> and converted into a map to decode the raw data. However, this revealed another issue where the key in the key-value pairs mapping the factor to its description all have a length of 3. So, the raw data needs to be padded to match the variable description keys. The resulting process to decode the data follows these steps:</p>
<ol type="1">
<li>Pad raw data with zeros on the left to a maximum length of 3.</li>
<li>Construct the URL to download the JWDP code mapping for the specified year.</li>
<li>Downloads and reads the JSON file, extracts the mapping of JWDP codes to time ranges, and convert to a list.</li>
<li>Renames the mapping key “0” to “000” to match the padded JWDP raw data.</li>
<li>Loop over each row/observation in the tibble
<ul>
<li>If the JWDP code is “000” (which means “Not applicable”), sets it to NA.</li>
<li>Otherwise, splits the mapped time range (e.g., “5:00 a.m. to 5:29 a.m.”) into start and end times, removes periods, and converts all characters to uppercase.</li>
<li>Parses the start and end times, converts them to numeric (seconds or minutes), and calculates the midpoint.</li>
<li>Assigns the midpoint value back to the JWDP column for that row.</li>
<li>Converts the JWDP column to numeric values (the tibble coerces it back to a character).</li>
<li>Converts the JWDP column to HMS (hour-minute-second) time format.</li>
<li>Removes “JWDP” from the num_vars vector, since it is no longer a numeric variable.</li>
</ul></li>
</ol>
<p>This approach is likely more complicated than it needs to be, but it was the first solution we developed. One major issue with this approach is the for loop which is inherently slower in an interpreted language like R, especially when multiple complex statements are nested within. In production, this code should be rewritten for optimization. The same process is followed for both <code>JWDP</code> and <code>JWAP</code>.</p>
<p>The final portion of <code>get_single_year()</code> converts all categorical variables into factors with labels pulled from the official variable descriptions queried from <code>census.gov</code>. The process of converting the categorical variables into factors with levels is as follows:</p>
<ol type="1">
<li>Iterates through each variable in the vector cat_vars.</li>
<li>Constructs the URL to download the JSON variable map for the current variable and year.</li>
<li>Downloads the JSON file, reads it as a single string, parse it, and extracts the mapping of codes to labels for the variable.</li>
<li>Removes leading zeros from the code names (except for the value “0”), so that codes in the data (which may not have leading zeros) will match the JSON map keys.</li>
<li>Converts the column df[[variable]] (for each cat_var) into a factor, using the cleaned names as levels and the corresponding labels from the map as the factor labels.</li>
</ol>
<p>Last, the remaining numeric variables are converted from character to numeric and the tibble is returned. Note there is no data for 2020.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>get_single_year <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">year =</span> <span class="dv">2022</span>, <span class="at">num_vars =</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>), </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"SEX"</span>), <span class="at">geography =</span> <span class="st">"State"</span>, <span class="at">geography_level =</span> <span class="fu">c</span>(<span class="st">":13"</span>)) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate Survey Year</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(year)) {</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Year must be numeric"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2010</span><span class="sc">:</span><span class="dv">2019</span>, <span class="dv">2021</span><span class="sc">:</span><span class="dv">2022</span>))) {</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Year must be between 2010 and 2019 or 2021, 2022"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate Numeric Variables</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"PWGTP"</span> <span class="sc">%in%</span> num_vars)) {</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"PWGTP must be included in the numeric variables"</span>)</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(num_vars) <span class="sc">&lt;</span> <span class="dv">2</span>) {</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"At least one numeric variable besides PWGTP is required"</span>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(num_vars <span class="sc">%in%</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">c</span>(<span class="st">"AGEP"</span>,<span class="st">"GASP"</span>,<span class="st">"GRPIP"</span>,<span class="st">"JWAP"</span>,<span class="st">"JWDP"</span>,<span class="st">"JWMNP"</span>,<span class="st">"PWGTP"</span>))) {</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Undefined numeric variable(s)"</span>)</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate Categorical Variables</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(cat_vars) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"At least one categorical variable required"</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(cat_vars <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FER"</span>, <span class="st">"HHL"</span>, <span class="st">"HISPEED"</span>, <span class="st">"JWTRNS"</span>, <span class="st">"SCH"</span>, <span class="st">"SCHL"</span>, <span class="st">"SEX"</span>))) {</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Undefined categorical variable(s)"</span>)</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate Region Variable</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>(geography <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"State"</span>, <span class="st">"Division"</span>, <span class="st">"Region"</span>))) {</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Geography must be 'Region', 'Division' or 'State'"</span>)</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate Geography Level</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (geography <span class="sc">==</span> <span class="st">"State"</span> <span class="sc">&amp;&amp;</span> (geography_level <span class="sc">%in%</span> st_codes) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Invalid State value. Find defined state codes at</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a><span class="st">             https://api.census.gov/data/2022/acs/acs1/pums/variables/ST.json"</span>)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (geography <span class="sc">==</span> <span class="st">"Division"</span> <span class="sc">&amp;&amp;</span> (<span class="fu">as.numeric</span>(geography_level) <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Valid Division values are between 1 and 9"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (geography <span class="sc">==</span> <span class="st">"Region"</span> <span class="sc">&amp;&amp;</span> (<span class="fu">as.numeric</span>(geography_level) <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">==</span> <span class="cn">FALSE</span>)) {</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">stop</span>(<span class="st">"Valid Region values are between 1 and 4"</span>)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Check if variables are present in selected year</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    all_vars <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.census.gov/data/"</span>, <span class="fu">as.character</span>(year), <span class="st">"/acs/acs1/pums/variables"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>        <span class="fu">GET</span>() <span class="sc">|&gt;</span> <span class="fu">content</span>(<span class="at">as=</span><span class="st">"parsed"</span>) <span class="sc">|&gt;</span> <span class="fu">tail</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">lapply</span>(<span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">c</span>(num_vars, cat_vars) <span class="sc">%in%</span> all_vars)) {</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">warning</span>(<span class="fu">paste</span>(<span class="st">"The following variables: ("</span>,</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">setdiff</span>(<span class="fu">c</span>(num_vars, cat_vars), all_vars),</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                      <span class="st">") are undefined for year"</span>,</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">as.character</span>(year), <span class="at">sep =</span> <span class="st">" "</span>))</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="fu">tibble</span>())</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">#Create geography argument for the query</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>    geography <span class="ot">&lt;-</span> <span class="fu">paste0</span>(geography, <span class="st">":"</span>, <span class="fu">paste</span>(geography_level, <span class="at">collapse =</span> <span class="st">","</span>))</span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.census.gov/data/"</span>, <span class="fu">as.character</span>(year), <span class="st">"/acs/acs1/pums?"</span>)</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">GET</span>(url, <span class="at">query =</span> <span class="fu">list</span>(<span class="at">get=</span><span class="fu">paste</span>(<span class="fu">c</span>(num_vars, cat_vars), <span class="at">collapse=</span><span class="st">","</span>), <span class="st">`</span><span class="at">for</span><span class="st">`</span><span class="ot">=</span>geography))</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">get_pums_tibble</span>(res)</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert Journey to Work Departure Time to HH:MM Format</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"JWDP"</span> <span class="sc">%in%</span> num_vars <span class="sc">&amp;&amp;</span> <span class="st">"JWDP"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>        df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">JWDP =</span> <span class="fu">str_pad</span>(JWDP, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>))</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>        jwdp_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.census.gov/data/"</span>, <span class="fu">as.character</span>(year),</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"/acs/acs1/pums/variables/JWDP.json"</span>)</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>        jwdp_map <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">paste</span>(<span class="fu">readLines</span>(jwdp_file), <span class="at">collapse=</span><span class="st">""</span>))<span class="sc">$</span>values<span class="sc">$</span>item <span class="sc">|&gt;</span> <span class="fu">as.list</span>()</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(jwdp_map)[<span class="fu">names</span>(jwdp_map) <span class="sc">==</span> <span class="st">"0"</span>] <span class="ot">&lt;-</span> <span class="st">"000"</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (df<span class="sc">$</span>JWDP[i] <span class="sc">==</span> <span class="st">"000"</span>) {</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>                df<span class="sc">$</span>JWDP[i] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>                iv <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(jwdp_map[[ df<span class="sc">$</span>JWDP[i] ]], <span class="st">" to "</span>)[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">str_to_upper</span>()</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>                mid <span class="ot">&lt;-</span> ((<span class="fu">as.numeric</span>(<span class="fu">parse_time</span>(iv[<span class="dv">2</span>])) <span class="sc">+</span> <span class="fu">as.numeric</span>(<span class="fu">parse_time</span>(iv[<span class="dv">1</span>])) ) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>                df<span class="sc">$</span>JWDP[i] <span class="ot">&lt;-</span> mid</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">JWDP =</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="fu">as.numeric</span>(JWDP)))</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>        num_vars <span class="ot">&lt;-</span> num_vars[num_vars <span class="sc">!=</span> <span class="st">"JWDP"</span>]</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert Journey to Work Arrival Time to HH:MM Format</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"JWAP"</span> <span class="sc">%in%</span> num_vars <span class="sc">&amp;&amp;</span> <span class="st">"JWAP"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) {</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">JWAP =</span> <span class="fu">str_pad</span>(JWAP, <span class="at">width =</span> <span class="dv">3</span>, <span class="at">side =</span> <span class="st">"left"</span>, <span class="at">pad =</span> <span class="st">"0"</span>))</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>        jwap_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.census.gov/data/"</span>, <span class="fu">as.character</span>(year),</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"/acs/acs1/pums/variables/JWAP.json"</span>)</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>        jwap_map <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">paste</span>(<span class="fu">readLines</span>(jwap_file), <span class="at">collapse=</span><span class="st">""</span>))<span class="sc">$</span>values<span class="sc">$</span>item <span class="sc">|&gt;</span> <span class="fu">as.list</span>()</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(jwap_map)[<span class="fu">names</span>(jwap_map) <span class="sc">==</span> <span class="st">"0"</span>] <span class="ot">&lt;-</span> <span class="st">"000"</span></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df)) {</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> (df<span class="sc">$</span>JWAP[i] <span class="sc">==</span> <span class="st">"000"</span>) {</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>                df<span class="sc">$</span>JWAP[i] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>            } <span class="cf">else</span> {</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>                iv <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(jwap_map[[ df<span class="sc">$</span>JWAP[i] ]], <span class="st">" to "</span>)[[<span class="dv">1</span>]] <span class="sc">|&gt;</span> <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">."</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">str_to_upper</span>()</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>                mid <span class="ot">&lt;-</span> ((<span class="fu">as.numeric</span>(<span class="fu">parse_time</span>(iv[<span class="dv">2</span>])) <span class="sc">+</span> <span class="fu">as.numeric</span>(<span class="fu">parse_time</span>(iv[<span class="dv">1</span>])) ) <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>                df<span class="sc">$</span>JWAP[i] <span class="ot">&lt;-</span> mid</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>        df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">JWAP =</span> hms<span class="sc">::</span><span class="fu">as_hms</span>(<span class="fu">as.numeric</span>(JWAP)))</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>        num_vars <span class="ot">&lt;-</span> num_vars[num_vars <span class="sc">!=</span> <span class="st">"JWAP"</span>]</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert Categorical Variables into Factors with Levels</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (variable <span class="cf">in</span> cat_vars) {</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>        var_url <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"https://api.census.gov/data/"</span>, year, <span class="st">"/acs/acs1/pums/variables/"</span>, variable, <span class="st">".json"</span>)</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>        var_map <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">paste</span>(<span class="fu">readLines</span>(var_url), <span class="at">collapse=</span><span class="st">""</span>))<span class="sc">$</span>values<span class="sc">$</span>item</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>        <span class="fu">names</span>(var_map) <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(<span class="fu">names</span>(var_map), <span class="st">"^0+(?!$)"</span>, <span class="st">""</span>)</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>        df[[variable]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(df[[variable]], <span class="at">levels =</span> <span class="fu">names</span>(var_map), <span class="at">labels =</span> <span class="fu">unlist</span>(<span class="fu">unname</span>(var_map)))</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert Numeric Variables to Numeric</span></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(num_vars), <span class="sc">~</span> <span class="fu">as.numeric</span>(.)))</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="multi-year-function" class="level1">
<h1>Multi-Year Function</h1>
<p>The <code>get_multi_years()</code> function takes in the same arguments as <code>get_single_year</code> with one exception, year is a vector of numbers rather than a single number. First <code>lapply()</code> iterates over the years vector calling <code>get_single_year()</code> for each element which returns a list of tibbles, one for each year. <code>mutate(.x, year = .y)</code> is used inside <code>map2_dfr()</code> to add a new column called year to each tibble <code>.x,</code> setting its value to <code>.y</code> (the corresponding year).<code>.x</code> is the current tibble (data for one year). <code>.y</code> is the current year from the years vector.<code>map2_dfr()</code> then binds all the tibbles together row-wise into a single tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>get_multi_years <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">2022</span>), <span class="at">num_vars =</span> <span class="fu">c</span>(<span class="st">"AGEP"</span>, <span class="st">"PWGTP"</span>),</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"SEX"</span>), <span class="at">geography =</span> <span class="st">"State"</span>, <span class="at">geography_level =</span> <span class="fu">c</span>(<span class="st">"13"</span>)) {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    myear_tibble <span class="ot">&lt;-</span> <span class="fu">lapply</span>(years, <span class="cf">function</span>(y) </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">get_single_year</span>(y, num_vars, cat_vars, geography, geography_level)) <span class="sc">|&gt;</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">map2_dfr</span>(years, <span class="sc">~</span> <span class="fu">mutate</span>(.x, <span class="at">year =</span> .y))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(myear_tibble)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generic-function-for-summarizing" class="level1">
<h1>Generic Function for Summarizing</h1>
<p>This method belongs to the <code>census</code> class which is an object of type <code>tibble()</code> returned from a call from either <code>get_single_year()</code> or <code>get_multi_year()</code>. This method will specify the behavior of the generic function <code>summary()</code> uniquely for a <code>census</code> object. The function arguments take in a census tibble and optional vectors of numeric and categorical variables. By default, the weighted means and standard deviations of all numeric variables and the weighted counts of all categorical variables will be returned. However, if the user specifies a vector of numeric or categorical variables in the function call, only summaries of those variables will be returned. <code>PWGTP</code> being a frequency count per household will not be summarized and will act as the weight for the means, standard deviations, and overall counts for each level of the categorical variables.</p>
<p>The <code>summarize()</code> function is used across all numeric variables excepting <code>PWGTP</code> with the provided weighted mean and standard deviation formulas. The resulting summary statistic is named according to the column being summarized. The categorical variables are counted my mapping the list of categorical variables to a function which first takes the data tibble. The function groups the tibble by each categorical one at a time, before <code>summarize()</code> adds a new variable called <code>Freq</code> by summing <code>PWGTP</code> from all observations for a given category level. The numeric summary tibbles are bound together with a row for each summary statistic, in this case two, and a column for each numeric variable summarized. This numeric summary tibble and the frequency tibbles are finally returned as a list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>summary.census <span class="ot">&lt;-</span> <span class="cf">function</span>(tibble, <span class="at">num_vars =</span> <span class="cn">NULL</span>, <span class="at">cat_vars =</span> <span class="cn">NULL</span>) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tibbles to store output</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    mean_tibble <span class="ot">&lt;-</span> sd_tibble <span class="ot">&lt;-</span> freq_tibbles <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Drop year if present since it's summary isn't needed</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    tibble <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">any_of</span>(<span class="st">"year"</span>))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if numeric variables are specified</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(num_vars)) {</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        mean_tibble <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(num_vars) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">all_of</span>(<span class="st">"PWGTP"</span>),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                                         <span class="sc">~</span> <span class="fu">sum</span>(.x <span class="sc">*</span> PWGTP) <span class="sc">/</span> <span class="fu">sum</span>(PWGTP), <span class="at">.names =</span> <span class="st">"{.col}"</span>))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        sd_tibble <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(num_vars) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">all_of</span>(<span class="st">"PWGTP"</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                        <span class="sc">~</span> <span class="fu">sqrt</span>(<span class="fu">sum</span>(.x<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> PWGTP) <span class="sc">/</span> <span class="fu">sum</span>(PWGTP) <span class="sc">-</span> (<span class="fu">sum</span>(.x <span class="sc">*</span> PWGTP) <span class="sc">/</span> <span class="fu">sum</span>(PWGTP))<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">.names =</span> <span class="st">"{.col}"</span>))</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if categorical variables are specified</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(cat_vars)) {</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        freq_tibbles <span class="ot">&lt;-</span> <span class="fu">map</span>(cat_vars,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">function</span>(v) {tibble <span class="sc">|&gt;</span> <span class="fu">group_by</span>(.data[[v]]) <span class="sc">|&gt;</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">summarize</span>(<span class="at">Freq =</span> <span class="fu">sum</span>(PWGTP), <span class="at">.groups =</span> <span class="st">"drop"</span>)})</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Default - return summaries of all numeric and counts of all categorical</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(num_vars) <span class="sc">&amp;&amp;</span> <span class="fu">is.null</span>(cat_vars)) {</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        mean_tibble <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">all_of</span>(<span class="st">"PWGTP"</span>),</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>                                             <span class="sc">~</span> <span class="fu">sum</span>(.x <span class="sc">*</span> PWGTP) <span class="sc">/</span> <span class="fu">sum</span>(PWGTP), <span class="at">.names =</span> <span class="st">"{.col}"</span>))</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>        sd_tibble <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">all_of</span>(<span class="st">"PWGTP"</span>),</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">~</span> <span class="fu">sqrt</span>( <span class="fu">sum</span>(.x<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> PWGTP) <span class="sc">/</span> <span class="fu">sum</span>(PWGTP) <span class="sc">-</span> (<span class="fu">sum</span>(.x <span class="sc">*</span> PWGTP) <span class="sc">/</span> <span class="fu">sum</span>(PWGTP))<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>                            <span class="at">.names =</span> <span class="st">"{.col}"</span>)) </span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>        cat_vars <span class="ot">&lt;-</span> tibble <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">where</span>(is.factor)) <span class="sc">|&gt;</span> <span class="fu">names</span>()</span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>        freq_tibbles <span class="ot">&lt;-</span> <span class="fu">map</span>(cat_vars,</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">function</span>(v) {tibble <span class="sc">|&gt;</span> <span class="fu">group_by</span>(.data[[v]]) <span class="sc">|&gt;</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">summarize</span>(<span class="at">Freq =</span> <span class="fu">sum</span>(PWGTP), <span class="at">.groups =</span> <span class="st">"drop"</span>)})</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    stat_tibble <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mean_tibble, sd_tibble) <span class="sc">|&gt;</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">stat =</span> <span class="fu">c</span>(<span class="st">"Mean"</span>, <span class="st">"Standard Deviation"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>        <span class="fu">select</span>(stat, <span class="fu">everything</span>())</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(stat_tibble, freq_tibbles))</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="generic-function-for-plotting" class="level1">
<h1>Generic Function for Plotting</h1>
<p>plot.census is a generic plot() function for a census class tibble. It requires the user to supply arguments for a tibble, one categorical variable and one numeric variables. The plot function uses ggplot, the aesthetic function and geom_boxplot function to create boxplots of the categorical variable levels on the x-axis and the numeric variable on the y-axis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plot.census <span class="ot">&lt;-</span> <span class="cf">function</span>(my_tibble, num_var, cat_var) {</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(my_tibble,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">get</span>(cat_var), <span class="at">y =</span> <span class="fu">get</span>(num_var),</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">weight =</span> PWGTP)) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Generic Plot Function"</span>, <span class="at">x =</span> cat_var, <span class="at">y =</span> num_var) <span class="sc">+</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">geom_boxplot</span>()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="function-verification-and-objects-of-class-census" class="level1">
<h1>Function Verification and Objects of Class ‘Census’</h1>
<p>This code chunk contains code that verifies all functions in this project:</p>
<ul>
<li>get_single_year, called by syear_test</li>
<li>get_multi_years, called by myear _test</li>
<li>summary.census, called by summary(syear_test) or summary(myear_test)</li>
<li>plot.census, called by plot(syear_test) or plot(myear_test)</li>
</ul>
<p>syear_test calls the single year function with arguments supplied for numeric, categorical, geography and geography level. Year is the default value in the single year function. myear_test calls the multi-year function with arguments supplied for years, numeric, categorical, geography, and geography level.</p>
<p>summary(syear_test) and summary(myear_test) calls the generic summary method for objects of type census. plot(syear_test) and plot(myear_test) calls the generic plot method for objects of type census.</p>
<p>This section also shows the two statements that are used to create objects of class Census and add this class to the single year tibble (syear_test) and multi-year tibble (myear_test). Both of these objects are type tibble when returned by the single year and multi-year functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>syear_test <span class="ot">&lt;-</span> <span class="fu">get_single_year</span>(<span class="at">num_vars =</span> <span class="fu">c</span>(<span class="st">"PWGTP"</span>,<span class="st">"AGEP"</span>,<span class="st">"JWDP"</span>),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"SEX"</span>, <span class="st">"JWTRNS"</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">geography =</span> <span class="st">"State"</span>, <span class="at">geography_level =</span> <span class="fu">c</span>(<span class="st">"02"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if
`.name_repair` is omitted as of tibble 2.0.0.
ℹ Using compatibility `.name_repair`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(jwdp_file): incomplete final line found on
'https://api.census.gov/data/2022/acs/acs1/pums/variables/JWDP.json'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(var_url): incomplete final line found on
'https://api.census.gov/data/2022/acs/acs1/pums/variables/SEX.json'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(var_url): incomplete final line found on
'https://api.census.gov/data/2022/acs/acs1/pums/variables/JWTRNS.json'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>myear_test <span class="ot">&lt;-</span> <span class="fu">get_multi_years</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">2019</span>, <span class="dv">2022</span>), <span class="at">num_vars =</span> <span class="fu">c</span>(<span class="st">"PWGTP"</span>,<span class="st">"AGEP"</span>,<span class="st">"JWDP"</span>),</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"SEX"</span>, <span class="st">"JWTRNS"</span>),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">geography =</span> <span class="st">"State"</span>, <span class="at">geography_level =</span> <span class="fu">c</span>(<span class="st">"02"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(jwdp_file): incomplete final line found on
'https://api.census.gov/data/2019/acs/acs1/pums/variables/JWDP.json'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(var_url): incomplete final line found on
'https://api.census.gov/data/2019/acs/acs1/pums/variables/SEX.json'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(var_url): incomplete final line found on
'https://api.census.gov/data/2019/acs/acs1/pums/variables/JWTRNS.json'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(jwdp_file): incomplete final line found on
'https://api.census.gov/data/2022/acs/acs1/pums/variables/JWDP.json'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(var_url): incomplete final line found on
'https://api.census.gov/data/2022/acs/acs1/pums/variables/SEX.json'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(var_url): incomplete final line found on
'https://api.census.gov/data/2022/acs/acs1/pums/variables/JWTRNS.json'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Add Class Census to Single Year Object</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(syear_test) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"census"</span>, <span class="fu">class</span>(syear_test))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Add Class Census to Multi Year Object</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(myear_test) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"census"</span>, <span class="fu">class</span>(myear_test))</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(syear_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 2 × 2
  stat                AGEP
  &lt;chr&gt;              &lt;dbl&gt;
1 Mean                37.0
2 Standard Deviation  22.2

[[2]]
[[2]][[1]]
# A tibble: 2 × 2
  SEX      Freq
  &lt;fct&gt;   &lt;dbl&gt;
1 Male   387793
2 Female 345790

[[2]][[2]]
# A tibble: 10 × 2
   JWTRNS                                                                   Freq
   &lt;fct&gt;                                                                   &lt;dbl&gt;
 1 Worked from home                                                        35036
 2 Taxicab                                                                  1909
 3 Bus                                                                      6498
 4 N/A (not a worker-not in the labor force, including persons under 16 … 379267
 5 Other method                                                            13981
 6 Bicycle                                                                   719
 7 Car, truck, or van                                                     269752
 8 Ferryboat                                                                 132
 9 Walked                                                                  25281
10 Motorcycle                                                               1008</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(myear_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 2 × 2
  stat                AGEP
  &lt;chr&gt;              &lt;dbl&gt;
1 Mean                36.7
2 Standard Deviation  22.2

[[2]]
[[2]][[1]]
# A tibble: 2 × 2
  SEX      Freq
  &lt;fct&gt;   &lt;dbl&gt;
1 Male   766269
2 Female 698859

[[2]][[2]]
# A tibble: 10 × 2
   JWTRNS                                                                   Freq
   &lt;fct&gt;                                                                   &lt;dbl&gt;
 1 Worked from home                                                        48366
 2 Taxicab                                                                  2588
 3 Bus                                                                      9604
 4 N/A (not a worker-not in the labor force, including persons under 16 … 766629
 5 Other method                                                            26395
 6 Bicycle                                                                  3170
 7 Car, truck, or van                                                     556684
 8 Walked                                                                  50377
 9 Ferryboat                                                                 262
10 Motorcycle                                                               1053</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(syear_test, <span class="at">cat_var =</span> <span class="st">"SEX"</span>, <span class="at">num_var =</span> <span class="st">"AGEP"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="project1_files/figure-html/Summary Function Verification-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(myear_test, <span class="at">cat_var =</span> <span class="st">"JWTRNS"</span>, <span class="at">num_var =</span> <span class="st">"AGEP"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="project1_files/figure-html/Summary Function Verification-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="investigation-research-question" class="level1">
<h1>Investigation (Research Question)</h1>
<p>Is there a difference between SEX for Gross Rent as Percent of household income over past 12 months (GASP) for Georgia Residents in 2021 and 2022?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>georgia_2122 <span class="ot">&lt;-</span> <span class="fu">get_multi_years</span>(<span class="at">years =</span> <span class="fu">c</span>(<span class="dv">2021</span>, <span class="dv">2022</span>), <span class="at">num_vars =</span> <span class="fu">c</span>(<span class="st">"PWGTP"</span>,<span class="st">"GASP"</span>),</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cat_vars =</span> <span class="fu">c</span>(<span class="st">"SEX"</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">geography =</span> <span class="st">"State"</span>, <span class="at">geography_level =</span> <span class="fu">c</span>(<span class="st">"13"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(var_url): incomplete final line found on
'https://api.census.gov/data/2021/acs/acs1/pums/variables/SEX.json'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in readLines(var_url): incomplete final line found on
'https://api.census.gov/data/2022/acs/acs1/pums/variables/SEX.json'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(georgia_2122) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"census"</span>, <span class="fu">class</span>(georgia_2122))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(georgia_2122, <span class="at">num_vars =</span> <span class="st">"GASP"</span>, <span class="at">cat_vars =</span> <span class="st">"SEX"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 2 × 2
  stat                GASP
  &lt;chr&gt;              &lt;dbl&gt;
1 Mean                58.0
2 Standard Deviation 116. 

[[2]]
[[2]][[1]]
# A tibble: 2 × 2
  SEX        Freq
  &lt;fct&gt;     &lt;dbl&gt;
1 Male   10590186
2 Female 11122256</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Research Question Plots </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot 1 - Generic Plot Function</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(georgia_2122, <span class="at">num_var =</span> <span class="st">"GASP"</span>, <span class="at">cat_var =</span> <span class="st">"SEX"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="project1_files/figure-html/Research Question Gross Rent Percentage of Household Income by Sex-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot 2 - Generic Plot Function with Outliers Removed</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>georgia_2122 <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SEX, <span class="at">y =</span> GASP,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">weight =</span> PWGTP)) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Generic Plot with Outliers Removed"</span>, <span class="at">x =</span> <span class="st">"SEX"</span>, <span class="at">y =</span> <span class="st">"GASP"</span>) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="project1_files/figure-html/Research Question Gross Rent Percentage of Household Income by Sex-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot 3 - Generic Plot Function with Range y = 0 - 250</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>georgia_2122 <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SEX, <span class="at">y =</span> GASP,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">weight =</span> PWGTP)) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Generic Plot with Focus on IQR"</span>, </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x =</span> <span class="st">"SEX"</span>, <span class="at">y =</span> <span class="st">"GASP"</span>) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">250</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="project1_files/figure-html/Research Question Gross Rent Percentage of Household Income by Sex-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot 4 - Generic Plot Function with Range y = 0 - 50 </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>georgia_2122 <span class="sc">|&gt;</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> SEX, <span class="at">y =</span> GASP,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">weight =</span> PWGTP)) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Generic Plot with Focus on Median"</span>, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x =</span> <span class="st">"SEX"</span>, <span class="at">y =</span> <span class="st">"GASP"</span>) <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="project1_files/figure-html/Research Question Gross Rent Percentage of Household Income by Sex-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Summary of Research</strong><br>
In order to answer the research question, we first tried the generic plot function for GASP vs.&nbsp;SEX (see Plot #1 in code chunk above). From inspection of this plot, we can see that the data is highly right skewed numeric data. The skewness distorts the axis for the numeric variable of interest (GASP), and as a result, the plot does not provide useful information.</p>
<p>In order to address this limitation, we took the generic plotting function outside of the function and made three (3) different plots to get to a useful result:</p>
<ol type="1">
<li><p>First, we removed outliers to determine the effect on the range of GASP (see Plot #2 in Research Question code chunk above). With outliers were removed, we were still unable to determine the shape of the distribution around the highest density interval, represented by the Inter-Quartile Range (IQR).</p></li>
<li><p>Second, we zoomed in on the Box and Whiskers. We were still unable to determine if there was a meaningful difference between males and females (see Plot #3 in Research Question code chunk) Note that the IQR for this plot is the same but the medians are different.</p></li>
<li><p>Finally, we generated a third box plot, zooming in on the median. Here, we see that the median GASP for females is approximately 20, while the median GASP for males is approximately 3 (see Plot #4 in code chunk above).</p></li>
</ol>
<p><strong>Conclusion on Research</strong><br>
This suggests that the distributions of GASP between males and females are similar in shape, especially in the tails, but the center of the distributions appear to be different. Whether or not this is a meaningful difference we cannot tell without numerical methods that quantify variability beyond the capabilities of the boxplot.</p>
<p><strong>Questionable Content</strong></p>
<p><em>From Single Year Function Text</em><br>
The <code>get_single_year()</code> function itself is too long and ideally would be split into 3 additonal functions. One for validating and formatting user input. A second for calculating the midpoint of the time ranges in <code>JWDP</code> and <code>JWAP</code> before converting them into an R time format. Finally, a third function for converting all the categorical variables into factors with appropriate labels pulled from <code>census.gov</code>’s variable descriptions. However, the project didn’t require this, so the code will be left in a monolithic format.</p>
<p><em>From Research Question Text</em><br>
From the results of our research on the question of interest, we conclude that the generic summary and plot functions are limited because we cannot supply ggplot options, filtering and selection statements. Therefore, the generic functions are not particularly useful to answer research questions on the data. The functions are useful for proof of concept, showing we understand how to create class methods, but not useful for exploratory data analysis.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>